<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Wild Rift Ultra Stats ‚Äì ERjanKG</title>
  <style>
    :root { 
      --p: #7b5cff; 
      --bg: #05070a; 
      --card: #111622; 
      --brd: rgba(255,255,255,0.15);
      --energy: #ffff00;
      --radius: 20px;
      /* –°–æ—á–Ω–∞—è –¢–µ—Ç—Ä–∞–¥–∞ */
      --t-s: #ff0055; /* –§—É–∫—Å–∏—è/–ö—Ä–∞—Å–Ω—ã–π */
      --t-a: #ff6600; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */
      --t-b: #ffcc00; /* –ñ–µ–ª—Ç—ã–π */
      --t-c: #00ffaa; /* –ë–∏—Ä—é–∑–æ–≤–æ-–∑–µ–ª–µ–Ω—ã–π */
    }

    body { 
      margin: 0; background: var(--bg); color: #fff; 
      font-family: "Inter", -apple-system, sans-serif; 
      font-weight: 800; -webkit-tap-highlight-color: transparent; 
    }

    .wrap { max-width: 1400px; margin: 0 auto; padding: 15px; }

    /* Header */
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .nick { font-size: 32px; font-weight: 900; letter-spacing: -1.5px; text-shadow: 0 0 20px rgba(123,92,255,0.5); }
    
    @keyframes spin { 0% { transform: rotate(0deg); } 20% { transform: rotate(360deg); } 100% { transform: rotate(360deg); } }
    .twitch-link { 
      display: flex; align-items: center; gap: 12px; text-decoration: none; 
      color: #fff; background: #9146ff; padding: 10px 20px; border-radius: 50px; 
      font-size: 16px; box-shadow: 0 5px 20px rgba(145,70,255,0.5); 
    }
    .twitch-link img { width: 22px; animation: spin 6s infinite ease-in-out; }

    /* Support */
    .support-box { background: var(--card); border: 2px solid var(--brd); padding: 25px; border-radius: var(--radius); margin-bottom: 20px; position: relative; overflow: hidden; }
    .support-box::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--p); }
    .donateBtn { 
      display: block; text-align: center; padding: 18px; margin-top: 15px; 
      background: #fff; color: #000; text-decoration: none; border-radius: 15px; 
      font-size: 18px; font-weight: 900; transition: 0.3s;
    }
    .donateBtn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(255,255,255,0.2); }

    /* Level Slider */
    .levelBar { background: var(--card); border: 2px solid var(--brd); padding: 25px; border-radius: var(--radius); margin-bottom: 20px; }
    input[type="range"] { 
      width: 100%; height: 12px; border-radius: 15px; background: #1e293b; 
      appearance: none; outline: none; margin: 20px 0;
    }
    input[type="range"]::-webkit-slider-thumb { 
      appearance: none; width: 32px; height: 32px; background: var(--p); 
      border-radius: 50%; border: 4px solid #fff; cursor: pointer; 
    }
    .range-labels { display: flex; justify-content: space-between; color: #64748b; font-size: 14px; }

    /* Table */
    .tableWrap { border: 2px solid var(--brd); border-radius: var(--radius); background: var(--card); overflow: auto; max-height: 80vh; }
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th { 
      background: #1a2233; color: #fff; font-size: 14px; padding: 20px 5px; 
      text-transform: uppercase; cursor: pointer; position: sticky; top: 0; z-index: 100;
      border-bottom: 4px solid var(--brd); letter-spacing: 2px;
    }
    td { padding: 15px 2px; text-align: center; border-bottom: 1px solid var(--brd); font-size: 16px; font-weight: 900; }
    tr.focused { background: rgba(123, 92, 255, 0.15) !important; }

    /* Champ Column */
    .champ-head-cell { display: flex; align-items: center; justify-content: center; gap: 10px; }
    .select-all-cb { width: 22px; height: 22px; cursor: pointer; accent-color: var(--p); }
    
    .champ-card-cell { display: flex; align-items: center; gap: 8px; padding: 0 10px; }
    .btn-row-del { 
      color: #ff4d4f; cursor: pointer; background: rgba(255,77,79,0.1); 
      border: 2px solid #ff4d4f; width: 26px; height: 26px; border-radius: 8px; font-weight: 900;
    }
    .champ-chip { 
      background: #2d3748; color: #fff; padding: 10px; border-radius: 12px; 
      width: 100%; text-align: center; border: 2px solid transparent; 
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 13px;
    }
    .champ-chip.pinned { border-color: var(--p); background: var(--p); box-shadow: 0 0 15px var(--p); }

    /* Tiers */
    .t-s { background: var(--t-s) !important; color: #fff; }
    .t-a { background: var(--t-a) !important; color: #fff; }
    .t-b { background: var(--t-b) !important; color: #000; }
    .t-c { background: var(--t-c) !important; color: #000; }
    .nrg-cell { color: var(--energy) !important; font-size: 12px !important; }

    /* TOOLTIP ENGINE */
    .has-tip { position: relative; cursor: help; }
    .tip-box { 
      visibility: hidden; position: absolute; bottom: 130%; left: 50%; transform: translateX(-50%);
      background: #fff; color: #000; padding: 10px 15px; border-radius: 12px; font-size: 14px;
      z-index: 1000; white-space: nowrap; font-weight: 900; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
      opacity: 0; transition: 0.2s; pointer-events: none;
    }
    .tip-box::after { content: ''; position: absolute; top: 100%; left: 50%; margin-left: -8px; border: 8px solid transparent; border-top-color: #fff; }
    .has-tip:hover .tip-box, .has-tip.active .tip-box { visibility: visible; opacity: 1; bottom: 110%; }

    /* Modal */
    .modal { position: fixed; inset: 0; z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 10px; }
    .hidden { display: none; }
    .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); }
    .modal-card { 
      position: relative; width: 100%; max-width: 1000px; height: 90vh; 
      background: #0f172a; border-radius: 40px; border: 2px solid var(--brd); 
      display: flex; flex-direction: column; overflow: hidden; 
    }
    
    .modal-header { padding: 30px; border-bottom: 2px solid var(--brd); }
    .search-input { 
      width: 100%; padding: 20px; background: #05070a; border: 2px solid var(--brd); 
      border-radius: 20px; color: #fff; font-size: 20px; font-weight: 800; outline: none;
    }
    .search-input:focus { border-color: var(--p); }

    .modal-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; padding: 20px; overflow-y: auto; flex: 1; }
    .role-col { display: flex; flex-direction: column; gap: 8px; }
    .role-head { 
      cursor: pointer; padding: 15px; text-align: center; background: #1e293b; 
      border-radius: 20px; border: 3px solid transparent; transition: 0.3s;
    }
    .role-head.active-role { border-color: var(--p); background: rgba(123,92,255,0.2); box-shadow: 0 0 20px rgba(123,92,255,0.4); }
    .role-head img { width: 35px; height: 35px; }
    
    .champ-btn { 
      width: 100%; padding: 14px 5px; border-radius: 12px; border: 2px solid var(--brd); 
      background: #0f172a; color: #64748b; font-size: 12px; font-weight: 900; cursor: pointer; 
    }
    .champ-btn.selected { background: var(--p); color: #fff; border-color: #fff; }

    .close-corner { 
      position: absolute; top: 25px; right: 25px; background: #ff4d4f; color: #fff; 
      border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; z-index: 100; font-size: 24px; font-weight: 900;
    }

    /* Avg Stats Block */
    .stats-footer { background: var(--card); border: 2px solid var(--brd); border-radius: var(--radius); padding: 20px; margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
    .stat-item { text-align: center; }
    .stat-label { font-size: 12px; color: #64748b; margin-bottom: 5px; }
    .stat-val { font-size: 20px; color: var(--p); }

    @media (max-width: 800px) {
      .modal-grid { grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; }
      .role-head img { width: 24px; height: 24px; }
      .champ-btn { font-size: 9px; padding: 10px 2px; }
      th { font-size: 11px; padding: 15px 2px; }
      td { font-size: 14px; }
      .nick { font-size: 24px; }
    }
  </style>
</head>
<body>

<div class="wrap">
  <div class="header-top">
    <div class="nick">ERjanKG</div>
    <a href="https://www.twitch.tv/ERjanKG" class="twitch-link" target="_blank">
      <img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Twitch_Glitch_Logo_Purple.svg" alt="T"> Twitch
    </a>
  </div>

  <div class="support-box">
    <div style="font-size: 16px; margin-bottom: 5px;">üî• –ü–û–î–î–ï–†–ñ–ö–ê –ü–†–û–ï–ö–¢–ê</div>
    <div style="opacity: 0.6; font-size: 12px;">–°–∞–π—Ç —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–µ–±–µ.</div>
    <a class="donateBtn" href="https://www.donationalerts.com/r/erjankg" target="_blank">üíú –ó–ê–î–û–ù–ê–¢–ò–¢–¨</a>
  </div>

  <div class="levelBar">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <span style="color:var(--p); font-size: 20px;">–£–†–û–í–ï–ù–¨:</span>
      <span id="levelVal" style="font-size: 32px; color:#fff">10</span>
    </div>
    <input id="level" type="range" min="1" max="15" value="10">
    <div class="range-labels">
      <span>1</span><span>3</span><span>5</span><span>7</span><span>9</span><span>11</span><span>13</span><span>15</span>
    </div>
  </div>

  <div class="tableWrap">
    <table>
      <thead>
        <tr>
          <th style="width:38%">
            <div class="champ-head-cell">
              <input type="checkbox" id="selectAll" class="select-all-cb" checked onclick="toggleSelectAll(this.checked)">
              <span onclick="openChampModal()">CHAMP ‚öôÔ∏è</span>
            </div>
          </th>
          <th onclick="setSort('ad')">AD<span id="s-ad" class="sort-arrow"></span></th>
          <th onclick="setSort('hp')">HP<span id="s-hp" class="sort-arrow"></span></th>
          <th onclick="setSort('mana')">MN<span id="s-mana" class="sort-arrow"></span></th>
          <th onclick="setSort('armor')">ARM<span id="s-armor" class="sort-arrow"></span></th>
          <th onclick="setSort('mr')">MR<span id="s-mr" class="sort-arrow"></span></th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div class="stats-footer" id="statsFooter"></div>
</div>

<div id="champModal" class="modal hidden">
  <div class="modal-backdrop" onclick="closeChampModal()"></div>
  <div class="modal-card">
    <button class="close-corner" onclick="closeChampModal()">‚úï</button>
    <div class="modal-header">
      <div style="font-size:24px; margin-bottom:15px;">–í–´–ë–û–† –ì–ï–†–û–ï–í</div>
      <input type="text" id="champSearch" class="search-input" placeholder="–ù–∞—á–Ω–∏ –ø–∏—Å–∞—Ç—å –∏–º—è..." oninput="renderChampModal()">
    </div>
    <div id="champModalGrid" class="modal-grid"></div>
  </div>
</div>

<script>
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnqVwUluQiuho1Wj6A3tZRvDJsLlyAZYmg0soWy4EJ_Un00P8e3Y2EAo3Iv6KvMm5HPwce_0AnzPfb/pub?gid=0&single=true&output=tsv";
  const COLS = ["ad", "hp", "mana", "armor", "mr"];
  const roles = [
    { key: "Top", icon: "assets/roles/top.png" },
    { key: "Jungle", icon: "assets/roles/jungle.png" },
    { key: "Mid", icon: "assets/roles/mid.png" },
    { key: "ADC", icon: "assets/roles/adc.png" },
    { key: "Support", icon: "assets/roles/support.png" }
  ];

  let raw = [], selected = new Set(), pinned = new Set(), level = 10, sortK = 'ad', sortD = 'desc';

  // Load from Storage
  if(localStorage.getItem('pinned')) pinned = new Set(JSON.parse(localStorage.getItem('pinned')));
  if(localStorage.getItem('level')) level = +localStorage.getItem('level');

  async function init() {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const lines = text.trim().split('\n').map(l => l.split('\t'));
    const h = lines[0].map(s => s.trim());
    raw = lines.slice(1).map(row => {
      let o = {}; h.forEach((n, i) => o[n] = row[i]?.trim());
      return {
        name: o["Champion"], ad_b: +o["AD_Base"], ad_g: +o["AD_Growth"],
        hp_b: +o["HP_Base"], hp_g: +o["HP_Growth"], mn_b: +o["Mana_Base"], mn_g: +o["Mana_Growth"],
        ar_b: +o["Armor_Base"], ar_g: +o["Armor_Growth"], mr_b: +o["MR_Base"], mr_g: +o["MR_Growth"],
        res: o["Resource"] || "Mana",
        is: { Top: +o["Is_Top"]===1, Jungle: +o["Is_Jungle"]===1, Mid: +o["Is_Mid"]===1, ADC: +o["Is_Adc"]===1, Support: +o["Is_Support"]===1 }
      };
    }).filter(r => r.name);
    
    selected = new Set(raw.map(r => r.name));
    document.getElementById('level').value = level;
    document.getElementById('levelVal').innerText = level;
    renderTable();
  }

  function setSort(k) {
    if(sortK === k) sortD = sortD === 'desc' ? 'asc' : 'desc';
    else { sortK = k; sortD = 'desc'; }
    renderTable();
  }

  function renderTable() {
    const tbody = document.getElementById("tbody");
    COLS.forEach(k => {
      const el = document.getElementById('s-' + k);
      if(k === sortK) el.innerText = sortD === 'desc' ? ' ‚ñº' : ' ‚ñ≤';
      else el.innerText = '';
    });

    const data = raw.filter(r => selected.has(r.name)).map(r => {
      let c = (b, g) => b + (level - 1) * g;
      return { 
        name: r.name, res: r.res, 
        ad: c(r.ad_b, r.ad_g), hp: c(r.hp_b, r.hp_g), mana: c(r.mn_b, r.mn_g), armor: c(r.ar_b, r.ar_g), mr: c(r.mr_b, r.mr_g), 
        g: { ad: r.ad_g, hp: r.hp_g, mana: r.mn_g, armor: r.ar_g, mr: r.mr_g } 
      };
    }).sort((a,b) => sortD === 'desc' ? b[sortK] - a[sortK] : a[sortK] - b[sortK]);

    const thres = {};
    COLS.forEach(k => {
      let v = data.map(d => d[k]).sort((a,b) => a-b);
      thres[k] = { t1: v[Math.floor(v.length*0.98)], t10: v[Math.floor(v.length*0.85)], l10: v[Math.floor(v.length*0.15)] };
    });

    tbody.innerHTML = "";
    data.forEach(r => {
      const tr = document.createElement("tr");
      const isP = pinned.has(r.name);
      tr.onclick = () => {
        document.querySelectorAll('tr').forEach(t => t.classList.remove('focused'));
        tr.classList.add('focused');
      };

      tr.innerHTML = `<td><div class="champ-card-cell">
        <button class="btn-row-del" onclick="event.stopPropagation(); selected.delete('${r.name}'); renderTable();">‚úï</button>
        <div class="champ-chip ${isP?'pinned':''}" onclick="event.stopPropagation(); togglePin('${r.name}')">${r.name}</div>
      </div></td>`;
      
      COLS.forEach(k => {
        const td = document.createElement("td");
        td.className = "has-tip";
        const val = r[k];
        
        // Tooltip logic
        const tip = document.createElement("div");
        tip.className = "tip-box";
        tip.innerText = `–†–û–°–¢: +${r.g[k]}`;
        td.appendChild(tip);
        
        // Toggle for mobile
        td.onclick = (e) => {
          e.stopPropagation();
          const active = td.classList.contains('active');
          document.querySelectorAll('.has-tip').forEach(h => h.classList.remove('active'));
          if(!active) td.classList.add('active');
        };

        if(k === "mana" && r.res === "Energy") { td.classList.add("nrg-cell"); td.innerHTML += "NRG"; }
        else if(k === "mana" && val === 0) { td.style.opacity = "0.1"; td.innerHTML += "0"; }
        else {
          td.innerHTML += Math.round(val);
          if(val >= thres[k].t1) td.classList.add("t-s");
          else if(val >= thres[k].t10) td.classList.add("t-a");
          else if(val <= thres[k].l10) td.classList.add("t-c");
          else td.classList.add("t-b");
        }
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    renderFooterStats(data);
  }

  function renderFooterStats(data) {
    if(!data.length) return;
    const foot = document.getElementById("statsFooter");
    const avgAD = Math.round(data.reduce((a,b)=>a+b.ad,0)/data.length);
    const avgHP = Math.round(data.reduce((a,b)=>a+b.hp,0)/data.length);
    foot.innerHTML = `
      <div class="stat-item"><div class="stat-label">–°–†–ï–î–ù–ò–ô AD</div><div class="stat-val">${avgAD}</div></div>
      <div class="stat-item"><div class="stat-label">–°–†–ï–î–ù–ò–ô HP</div><div class="stat-val">${avgHP}</div></div>
      <div class="stat-item"><div class="stat-label">–ì–ï–†–û–ï–í</div><div class="stat-val">${data.length}</div></div>
    `;
  }

  function togglePin(name) { 
    pinned.has(name) ? pinned.delete(name) : pinned.add(name); 
    localStorage.setItem('pinned', JSON.stringify([...pinned]));
    renderTable(); 
  }

  function toggleSelectAll(checked) {
    selected = checked ? new Set(raw.map(r => r.name)) : new Set([...pinned]);
    renderTable();
  }

  function openChampModal() { document.getElementById("champModal").classList.remove("hidden"); renderChampModal(); }
  function closeChampModal() { document.getElementById("champModal").classList.add("hidden"); }

  function renderChampModal() {
    const grid = document.getElementById("champModalGrid");
    const query = document.getElementById("champSearch").value.toLowerCase();
    grid.innerHTML = "";

    roles.forEach(role => {
      const col = document.createElement("div"); col.className = "role-col";
      const namesInRole = raw.filter(r => r.is[role.key]).map(r => r.name);
      const isRoleFull = namesInRole.every(n => selected.has(n));

      col.innerHTML = `<div class="role-head ${isRoleFull?'active-role':''}" onclick="toggleRole('${role.key}')">
        <img src="${role.icon}">
      </div>`;
      
      const filtered = raw.filter(r => r.is[role.key] && r.name.toLowerCase().includes(query)).sort((a,b)=>a.name.localeCompare(b.name));
      filtered.forEach(r => {
        const btn = document.createElement("button");
        btn.className = "champ-btn" + (selected.has(r.name)?" selected":"");
        btn.innerText = r.name;
        btn.onclick = () => { 
          selected.has(r.name) ? selected.delete(r.name) : selected.add(r.name); 
          renderChampModal(); renderTable(); 
        };
        col.appendChild(btn);
      });
      grid.appendChild(col);
    });
  }

  function toggleRole(key) {
    const names = raw.filter(r => r.is[key]).map(r => r.name);
    const all = names.every(n => selected.has(n));
    names.forEach(n => all ? selected.delete(n) : selected.add(n));
    renderChampModal(); renderTable();
  }

  document.getElementById("level").oninput = (e) => {
    level = +e.target.value; 
    document.getElementById("levelVal").innerText = level; 
    localStorage.setItem('level', level);
    renderTable();
  };

  // Close tips
  window.onclick = () => document.querySelectorAll('.has-tip').forEach(h => h.classList.remove('active'));

  init();
</script>
</body>
</html>