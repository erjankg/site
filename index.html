<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Wild Rift Stats PRO</title>
    <style>
        /* =========================================
           1. –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –¢–ï–ú–´
           ========================================= */
        :root {
            --bg: #05070a; --card: #111622; --text: #ffffff; --sub: #a0aec0;
            --brd: rgba(255, 255, 255, 0.1); --primary: #7b5cff;
            --t-s: #ff7f7f; --t-a: #ffbf7f; --t-b: #ffff7f; --t-c: #7fff7f;
        }
        body.light-mode {
            --bg: #f0f2f5; --card: #ffffff; --text: #1a202c; --sub: #4a5568;
            --brd: rgba(0, 0, 0, 0.1); --primary: #6366f1;
            --t-s: #ff9999; --t-a: #ffcc99; --t-b: #ffff99; --t-c: #99ff99;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { 
            margin: 0; padding: 0; width: 100%; overflow-x: hidden; 
            font-family: system-ui, -apple-system, sans-serif; font-weight: 800;
            background: var(--bg); color: var(--text); transition: background 0.3s;
        }

        .wrapper { width: 100%; max-width: 100%; padding: 10px; margin: 0 auto; }

        /* =========================================
           2. –®–ê–ü–ö–ê –ò –ö–ù–û–ü–ö–ò (–ê–ù–ò–ú–ê–¶–ò–Ø)
           ========================================= */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .logo { font-size: 1.2rem; font-weight: 900; }
        
        .twitch-btn {
            background: #9146ff; color: #fff; padding: 8px 12px; border-radius: 20px;
            text-decoration: none; font-size: 12px; animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(145, 70, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(145, 70, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(145, 70, 255, 0); }
        }

        .theme-toggle { 
            background: var(--card); border: 1px solid var(--brd); 
            color: var(--text); padding: 5px 10px; border-radius: 10px; cursor: pointer;
        }

        .support-box { 
            background: var(--card); border: 1px solid var(--brd); 
            padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center;
        }
        .support-link { 
            display: block; background: var(--primary); color: #fff; 
            text-decoration: none; padding: 12px; border-radius: 10px; font-size: 14px;
        }

        /* =========================================
           3. –ü–û–õ–ó–£–ù–û–ö
           ========================================= */
        .lvl-box { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        .lvl-head { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
        input[type="range"] { width: 100%; height: 8px; appearance: none; background: #2d3748; border-radius: 5px; }
        input[type="range"]::-webkit-slider-thumb { appearance: none; width: 22px; height: 22px; background: #fff; border: 3px solid var(--primary); border-radius: 50%; }
        .ruler { display: flex; justify-content: space-between; margin-top: 8px; font-size: 10px; color: var(--sub); }

        /* =========================================
           4. –¢–ê–ë–õ–ò–¶–ê (–ó–ê–¢–ï–ú–ù–ï–ù–ò–ï –ò –°–ö–†–û–õ–õ)
           ========================================= */
        .table-container { 
            width: 100%; overflow-x: auto; background: var(--card); 
            border-radius: 15px; border: 1px solid var(--brd);
            -webkit-overflow-scrolling: touch;
        }
        table { width: 100%; border-collapse: collapse; min-width: 500px; table-layout: fixed; }
        th { 
            background: var(--card); padding: 12px 5px; font-size: 11px; 
            position: sticky; top: 0; z-index: 10; border-bottom: 2px solid var(--brd);
        }
        
        /* –õ–æ–≥–∏–∫–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è */
        table.focus-mode td:not(:first-child) { opacity: 0.4; } /* –ó–∞—Ç–µ–º–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—ã */
        table.focus-mode td.active-col { opacity: 1 !important; background: rgba(123, 92, 255, 0.1); }
        
        td { padding: 10px 2px; text-align: center; font-size: 13px; border-bottom: 1px solid var(--brd); }
        
        .champ-name { 
            display: block; padding: 6px; background: #2d3748; border-radius: 6px; 
            font-size: 10px; overflow: hidden; text-overflow: ellipsis; cursor: pointer;
        }
        .pinned { background: var(--primary) !important; color: #fff; box-shadow: 0 0 10px var(--primary); }

        /* –¶–≤–µ—Ç–∞ –¢–∏—Ä–æ–≤ */
        .s { background: var(--t-s) !important; color: #000; }
        .a { background: var(--t-a) !important; color: #000; }
        .b { background: var(--t-b) !important; color: #000; }
        .c { background: var(--t-c) !important; color: #000; }

        /* =========================================
           5. –ú–û–î–ê–õ–ö–ê
           ========================================= */
        .modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            display: none; z-index: 1000; padding: 10px; 
        }
        .modal-content { 
            background: var(--bg); width: 100%; height: 90vh; border-radius: 20px; 
            display: flex; flex-direction: column; position: relative;
        }
        .modal-grid { 
            flex: 1; display: grid; grid-template-columns: repeat(5, 1fr); 
            gap: 8px; padding: 10px; overflow-y: auto; 
        }
        .role-btn { 
            background: var(--card); padding: 10px; border-radius: 10px; 
            text-align: center; border: 2px solid transparent; 
        }
        .role-btn.on { border-color: var(--primary); }
        .role-btn img { width: 20px; height: 20px; }
        .champ-item { 
            padding: 8px 2px; background: var(--card); border: 1px solid var(--brd); 
            border-radius: 6px; font-size: 9px; color: var(--sub); cursor: pointer;
        }
        .champ-item.on { background: var(--primary); color: #fff; }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ (Tooltip) —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π title –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –±–ª–æ–∫ */
        .custom-tip { position: absolute; background: #fff; color: #000; padding: 5px; border-radius: 5px; display: none; z-index: 100; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <div class="logo">ERjanKG</div>
        <div style="display:flex; gap:10px;">
            <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
            <a href="https://www.twitch.tv/ERjanKG" class="twitch-btn" target="_blank">TWITCH</a>
        </div>
    </div>

    <div class="support-box">
        <a href="https://www.donationalerts.com/r/erjankg" class="support-link" target="_blank">–ü–û–î–î–ï–†–ñ–ê–¢–¨</a>
    </div>

    <div class="lvl-box">
        <div class="lvl-head"><span>–£–†–û–í–ï–ù–¨:</span><span id="lvlVal" style="font-size:20px; color:var(--primary)">10</span></div>
        <input type="range" id="lvlIn" min="1" max="15" value="10">
        <div class="ruler"><span>1</span><span>5</span><span>10</span><span>15</span></div>
    </div>

    <div class="table-container">
        <table id="mainTable">
            <thead>
                <tr>
                    <th style="width:100px">
                        <input type="checkbox" id="masterBox" checked onclick="masterToggle(this.checked)">
                        <span onclick="openModal()" style="border-bottom:1px solid">CHAMP ‚öôÔ∏è</span>
                    </th>
                    <th onclick="setSort('ad')">AD <span id="s-ad"></span></th>
                    <th onclick="setSort('hp')">HP <span id="s-hp"></span></th>
                    <th onclick="setSort('mana')">MN <span id="s-mana"></span></th>
                    <th onclick="setSort('armor')">AR <span id="s-armor"></span></th>
                    <th onclick="setSort('mr')">MR <span id="s-mr"></span></th>
                </tr>
            </thead>
            <tbody id="tBody"></tbody>
        </table>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <button onclick="closeModal()" style="position:absolute; top:10px; right:10px; background:red; color:#fff; border:none; border-radius:50%; width:30px; height:30px;">‚úï</button>
        <div style="padding:40px 10px 10px;"><input type="text" id="mSearch" placeholder="–ü–æ–∏—Å–∫..." style="width:100%; padding:10px; border-radius:10px; border:1px solid var(--brd); background:var(--card); color:var(--text);" oninput="renderModal()"></div>
        <div id="mGrid" class="modal-grid"></div>
    </div>
</div>

<script>
    const URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnqVwUluQiuho1Wj6A3tZRvDJsLlyAZYmg0soWy4EJ_Un00P8e3Y2EAo3Iv6KvMm5HPwce_0AnzPfb/pub?gid=0&single=true&output=tsv";
    let raw = [], selected = new Set(), pinned = new Set(), lvl = 10, sK = 'ad', sD = 'desc';

    async function init() {
        const r = await fetch(URL);
        const t = await r.text();
        const rows = t.trim().split('\n').map(l => l.split('\t'));
        const h = rows[0].map(c => c.trim());
        raw = rows.slice(1).map(row => {
            let o = {}; h.forEach((n, i) => o[n] = row[i]?.trim());
            return {
                name: o["Champion"], 
                ad_b: +o["AD_Base"], ad_g: +o["AD_Growth"],
                hp_b: +o["HP_Base"], hp_g: +o["HP_Growth"],
                mn_b: +o["Mana_Base"], mn_g: +o["Mana_Growth"],
                ar_b: +o["Armor_Base"], ar_g: +o["Armor_Growth"],
                mr_b: +o["MR_Base"], mr_g: +o["MR_Growth"],
                is: { Top: +o["Is_Top"]==1, Jungle: +o["Is_Jungle"]==1, Mid: +o["Is_Mid"]==1, ADC: +o["Is_Adc"]==1, Support: +o["Is_Support"]==1 }
            };
        }).filter(x => x.name);
        selected = new Set(raw.map(x => x.name));
        render();
    }

    function setSort(k) {
        if(sK === k) sD = sD === 'desc' ? 'asc' : 'desc';
        else { sK = k; sD = 'desc'; }
        render();
    }

    function render() {
        const b = document.getElementById("tBody");
        const table = document.getElementById("mainTable");
        table.classList.add("focus-mode");

        document.querySelectorAll('th span').forEach(s => s.innerText = '');
        document.getElementById('s-'+sK).innerText = sD === 'desc' ? '‚ñº' : '‚ñ≤';

        const data = raw.filter(x => selected.has(x.name)).map(x => {
            const c = (b, g) => b + (lvl - 1) * g;
            return { name: x.name, ad: c(x.ad_b, x.ad_g), hp: c(x.hp_b, x.hp_g), mana: c(x.mn_b, x.mn_g), armor: c(x.ar_b, x.ar_g), mr: c(x.mr_b, x.mr_g), grow: {ad:x.ad_g, hp:x.hp_g, mana:x.mn_g, armor:x.ar_g, mr:x.mr_g} };
        }).sort((a,b) => sD === 'desc' ? b[sK] - a[sK] : a[sK] - b[sK]);

        const thres = {};
        ['ad','hp','mana','armor','mr'].forEach(k => {
            let v = data.map(d => d[k]).sort((a,b) => a-b);
            thres[k] = { s: v[Math.floor(v.length*0.95)], a: v[Math.floor(v.length*0.80)], c: v[Math.floor(v.length*0.20)] };
        });

        b.innerHTML = "";
        data.forEach(x => {
            const tr = document.createElement("tr");
            const isP = pinned.has(x.name);
            tr.innerHTML = `<td><span class="champ-name ${isP?'pinned':''}" onclick="togglePin('${x.name}')">${x.name}</span></td>`;
            
            ['ad','hp','mana','armor','mr'].forEach(k => {
                const td = document.createElement("td");
                const v = x[k];
                if(k === sK) td.className = "active-col ";
                
                td.innerText = Math.round(v);
                if(v >= thres[k].s) td.className += "s";
                else if(v >= thres[k].a) td.className += "a";
                else if(v <= thres[k].c) td.className += "c";
                else td.className += "b";

                td.onclick = () => alert(x.name + " " + k.toUpperCase() + " –ü—Ä–∏—Ä–æ—Å—Ç: +" + x.grow[k]);
                tr.appendChild(td);
            });
            b.appendChild(tr);
        });
    }

    function togglePin(n) { pinned.has(n) ? pinned.delete(n) : pinned.add(n); render(); }

    function masterToggle(on) {
        if(on) selected = new Set(raw.map(x => x.name));
        else selected = new Set([...pinned]);
        render();
    }

    function openModal() { document.getElementById("modal").style.display = "block"; renderModal(); }
    function closeModal() { document.getElementById("modal").style.display = "none"; }

    function renderModal() {
        const g = document.getElementById("mGrid");
        const q = document.getElementById("mSearch").value.toLowerCase();
        g.innerHTML = "";
        const roles = ["Top","Jungle","Mid","ADC","Support"];
        roles.forEach(r => {
            const col = document.createElement("div"); col.style.display="flex"; col.style.flexDirection="column"; col.style.gap="5px";
            const champs = raw.filter(x => x.is[r]);
            const isAll = champs.every(x => selected.has(x.name));
            
            const rb = document.createElement("div"); rb.className = "role-btn " + (isAll?'on':'');
            rb.innerHTML = `<img src="https://placehold.co/20x20?text=${r[0]}">`;
            rb.onclick = () => { champs.forEach(x => isAll ? selected.delete(x.name) : selected.add(x.name)); renderModal(); render(); };
            col.appendChild(rb);

            champs.filter(x => x.name.toLowerCase().includes(q)).forEach(x => {
                const i = document.createElement("div"); i.className = "champ-item " + (selected.has(x.name)?'on':'');
                i.innerText = x.name;
                i.onclick = () => { selected.has(x.name)?selected.delete(x.name):selected.add(x.name); renderModal(); render(); };
                col.appendChild(i);
            });
            g.appendChild(col);
        });
    }

    function toggleTheme() { document.body.classList.toggle("light-mode"); }

    document.getElementById("lvlIn").oninput = (e) => {
        lvl = +e.target.value; document.getElementById("lvlVal").innerText = lvl; render();
    };

    init();
</script>
</body>
</html>